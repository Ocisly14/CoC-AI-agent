# å‰ç«¯å¿«é€Ÿå¯åŠ¨æŒ‡å—

## æ¦‚è¿°

å‰ç«¯å·²ç»å®Œå–„ï¼Œè·³è¿‡äº†æ‰€æœ‰èµ„æºåŠ è½½ç¯èŠ‚ï¼Œå¯ä»¥ç›´æ¥å¯åŠ¨æ¸¸æˆè¿›è¡Œäº¤äº’ã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°
1. **æ¸¸æˆå¯åŠ¨** - æ— éœ€åŠ è½½æ¨¡ç»„ã€åœºæ™¯ã€NPC ç­‰èµ„æº
2. **Turn ç³»ç»Ÿ** - å¼‚æ­¥è¯·æ±‚/å“åº”æ¨¡å¼ï¼Œæ”¯æŒè½®è¯¢
3. **å®æ—¶èŠå¤©** - GameChat ç»„ä»¶ï¼Œå®æ—¶æ˜¾ç¤ºç©å®¶è¾“å…¥å’Œ Keeper å›åº”
4. **ä¼šè¯ç®¡ç†** - è‡ªåŠ¨ç®¡ç† session å’Œ turn å†å²
5. **è§’è‰²åˆ›å»º** - å®Œæ•´çš„ CoC 7e è§’è‰²å¡

### ğŸ® ç”¨æˆ·æµç¨‹

```
é¦–é¡µ â†’ ç‚¹å‡»"å¼€å§‹æ¸¸æˆ" â†’ æ¸¸æˆç•Œé¢ï¼ˆèŠå¤©ï¼‰
  â†“
è¾“å…¥è¡ŒåŠ¨ â†’ åç«¯å¤„ç†ï¼ˆOrchestrator â†’ Action â†’ Director â†’ Keeperï¼‰â†’ è¿”å›å™è¿°
```

## å¯åŠ¨æ–¹å¼

### 1. å¯åŠ¨åç«¯æœåŠ¡å™¨

```bash
cd client
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨

### 2. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰

```bash
cd client
npm run start
```

å‰ç«¯å°†åœ¨ `http://localhost:5173` å¯åŠ¨

### 3. ä½¿ç”¨æµç¨‹

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5173`
2. ç‚¹å‡» "ğŸ® å¼€å§‹æ¸¸æˆ" æŒ‰é’®
3. è¿›å…¥æ¸¸æˆèŠå¤©ç•Œé¢
4. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ çš„è¡ŒåŠ¨ï¼ˆä¾‹å¦‚ï¼š"æˆ‘ç¯é¡¾å››å‘¨ï¼Œå¯»æ‰¾å¯ç–‘çš„çº¿ç´¢"ï¼‰
5. ç‚¹å‡» "Send" æˆ–æŒ‰ Enter é”®å‘é€
6. ç­‰å¾… Keeper å›åº”ï¼ˆä¼šæ˜¾ç¤º "Thinking..." åŠ è½½çŠ¶æ€ï¼‰
7. ç»§ç»­äº’åŠ¨

## API ç«¯ç‚¹

### æ¸¸æˆæ§åˆ¶
- `POST /api/game/start` - å¯åŠ¨æ¸¸æˆï¼Œè¿”å› sessionId å’Œè§’è‰²ä¿¡æ¯
- `GET /api/gamestate` - è·å–å½“å‰æ¸¸æˆçŠ¶æ€

### Turn ç³»ç»Ÿ
- `POST /api/turns` - åˆ›å»ºæ–° turnï¼ˆå‘é€ç©å®¶è¾“å…¥ï¼‰
- `GET /api/turns/:turnId` - è½®è¯¢ turn çŠ¶æ€
- `GET /api/sessions/:sessionId/conversation` - è·å–å¯¹è¯å†å²
- `GET /api/sessions/:sessionId/turns` - è·å– turn å†å²

### è§’è‰²ç®¡ç†
- `POST /api/character` - åˆ›å»ºè§’è‰²
- `GET /api/characters` - è·å–æ‰€æœ‰è§’è‰²

## ç»„ä»¶è¯´æ˜

### GameChat (`client/src/components/GameChat.tsx`)
ä¸»æ¸¸æˆç•Œé¢ç»„ä»¶ï¼Œè´Ÿè´£ï¼š
- æ˜¾ç¤ºå¯¹è¯å†å²
- å¤„ç†ç”¨æˆ·è¾“å…¥
- è°ƒç”¨ turn API
- ä½¿ç”¨ useTurnPolling hook è½®è¯¢ turn çŠ¶æ€

### useTurnPolling (`client/src/hooks/useTurnPolling.ts`)
è‡ªå®šä¹‰ React hookï¼Œè´Ÿè´£ï¼š
- è½®è¯¢ turn çŠ¶æ€ï¼ˆæ¯ 1 ç§’ï¼‰
- ç®¡ç†è½®è¯¢ç”Ÿå‘½å‘¨æœŸ
- å¤„ç†é”™è¯¯å’Œå®ŒæˆçŠ¶æ€

## æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
  â†“
POST /api/turns (åˆ›å»º turn)
  â†“
è¿”å› turnId
  â†“
å¼€å§‹è½®è¯¢ GET /api/turns/:turnId
  â†“
åç«¯å¤„ç†ï¼ˆOrchestrator â†’ Action â†’ Director â†’ Keeperï¼‰
  â†“
Turn çŠ¶æ€å˜ä¸º 'completed'
  â†“
åœæ­¢è½®è¯¢ï¼Œæ˜¾ç¤º Keeper çš„å™è¿°
```

## è·³è¿‡çš„èµ„æºåŠ è½½

ä¸ºäº†å¿«é€Ÿå¯åŠ¨ï¼Œä»¥ä¸‹èµ„æºåŠ è½½å·²è¢«è·³è¿‡ï¼š

- âŒ NPC æ–‡æ¡£åŠ è½½
- âŒ Module èƒŒæ™¯åŠ è½½
- âŒ Scenario åœºæ™¯åŠ è½½
- âŒ RAG çŸ¥è¯†åº“åŠ è½½

è¿™æ„å‘³ç€ï¼š
- æ¸¸æˆå¯ä»¥ç«‹å³å¯åŠ¨
- ä½¿ç”¨é»˜è®¤è§’è‰²å’ŒåŸºç¡€çŠ¶æ€
- Keeper ä¾èµ– LLM çš„å³å…´èƒ½åŠ›ï¼Œè€Œä¸æ˜¯é¢„è®¾åœºæ™¯

## ä¸‹ä¸€æ­¥

å¦‚æœéœ€è¦åŠ è½½èµ„æºï¼Œå–æ¶ˆæ³¨é‡Š `client/server.ts` ä¸­çš„èµ„æºåŠ è½½ä»£ç ï¼š

```typescript
// åœ¨ /api/game/start ç«¯ç‚¹ä¸­ï¼Œå–æ¶ˆæ³¨é‡Šè¿™äº›è¡Œï¼š
// const npcLoader = new NPCLoader(db);
// await npcLoader.loadNPCsFromDirectory(npcDir);
// ... å…¶ä»–åŠ è½½å™¨
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯
- ç¡®è®¤åç«¯è¿è¡Œåœ¨ `http://localhost:3000`
- æ£€æŸ¥ CORS è®¾ç½®ï¼ˆå·²åœ¨ server.ts ä¸­é…ç½®ï¼‰

### é—®é¢˜ï¼šTurn ä¸€ç›´æ˜¾ç¤º "Thinking..."
- æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œçœ‹æ˜¯å¦æœ‰é”™è¯¯
- ç¡®è®¤ TurnManager å’Œ graph æ­£ç¡®åˆå§‹åŒ–
- æ£€æŸ¥ turnId æ˜¯å¦æ­£ç¡®ä¼ é€’

### é—®é¢˜ï¼šAPI è¿”å› 400 é”™è¯¯
- ç¡®è®¤æ¸¸æˆå·²é€šè¿‡ `/api/game/start` å¯åŠ¨
- æ£€æŸ¥ persistentGameState æ˜¯å¦å­˜åœ¨

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**: React 18 + TypeScript + Vite
- **åç«¯**: Express + SQLite + LangGraph
- **æ ·å¼**: åŸç”Ÿ CSSï¼ˆå¤å¤çº¸å¼ é£æ ¼ï¼‰
- **çŠ¶æ€ç®¡ç†**: React hooks (useState, useEffect)
